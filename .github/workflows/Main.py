# pip install -r requirements.txt

import phonenumbers
from phonenumbers import (
    carrier, geocoder, timezone, number_type,
    is_valid_number, is_possible_number,
    is_emergency_number, is_carrier_specific,
    PhoneNumberFormat, NumberParseException,
    region_code_for_number, region_codes_for_country_code,
    format_number_for_mobile_dialing,
    can_be_internationally_dialled,
    is_valid_number_for_region
)
from colorama import Fore, Style, init
import os

init(autoreset=True)

def banner():
    print(Fore.MAGENTA + Style.BRIGHT + r"""
â•­â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•®
â”ƒ         ğŸ“ KRSXH PHONE ANALYZER     â”ƒ
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯
""")

def type_to_str(t):
    import phonenumbers.phonenumberutil as putil
    mapping = {
        getattr(putil, "FIXED_LINE", -1): "ğŸ“ FIXED_LINE",
        getattr(putil, "MOBILE", -2): "ğŸ“± MOBILE",
        getattr(putil, "FIXED_LINE_OR_MOBILE", -3): "ğŸ“±ğŸ“ MOBILE/FIXED",
        getattr(putil, "TOLL_FREE", -4): "ğŸ†“ TOLL_FREE",
        getattr(putil, "PREMIUM_RATE", -5): "ğŸ’¸ PREMIUM_RATE",
        getattr(putil, "SHARED_COST", -6): "ğŸ¤ SHARED_COST",
        getattr(putil, "VOIP", -7): "ğŸŒ VOIP",
        getattr(putil, "PERSONAL_NUMBER", -8): "ğŸ‘¤ PERSONAL_NUMBER",
        getattr(putil, "PAGER", -9): "ğŸ“Ÿ PAGER",
        getattr(putil, "UAN", -10): "ğŸ¢ UAN",
        getattr(putil, "VOICEMAIL", -11): "ğŸ“¤ VOICEMAIL",
    }
    return mapping.get(t, "â“ UNKNOWN")

def analyze_number(raw_input):
    try:
        p = phonenumbers.parse(raw_input, None)
        tz = timezone.time_zones_for_number(p)
        return {
            "ğŸ“¥ Entered Number": raw_input,
            "ğŸ”¢ E.164": phonenumbers.format_number(p, PhoneNumberFormat.E164),
            "ğŸ“ National": phonenumbers.format_number(p, PhoneNumberFormat.NATIONAL),
            "ğŸŒ International": phonenumbers.format_number(p, PhoneNumberFormat.INTERNATIONAL),
            "ğŸ§© RFC3966": phonenumbers.format_number(p, PhoneNumberFormat.RFC3966),
            "ğŸ“± Mobile Dial": format_number_for_mobile_dialing(p, None, True),
            "ğŸ”¢ Length": len(str(p.national_number)),
            "ğŸ“Œ Raw National": p.national_number,
            "ğŸŒ Country": geocoder.description_for_number(p, "en"),
            "ğŸ™ï¸ Region": geocoder.description_for_number(p, "en"),
            "ğŸŒ Country Code": p.country_code,
            "ğŸ—ºï¸ Region Code": region_code_for_number(p),
            "ğŸ—‚ï¸ All Regions": ', '.join(region_codes_for_country_code(p.country_code)),
            "ğŸ“¡ Carrier": carrier.name_for_number(p, "en"),
            "ğŸ“¶ Carrier Specific": "âœ…" if is_carrier_specific(p) else "âŒ",
            "ğŸ”  Type": type_to_str(number_type(p)),
            "ğŸ’  Type Code": number_type(p),
            "âœ… Valid": "âœ…" if is_valid_number(p) else "âŒ",
            "â” Possible": "âœ…" if is_possible_number(p) else "âŒ",
            "ğŸ“ Intl Dialable": "âœ…" if can_be_internationally_dialled(p) else "âŒ",
            "ğŸ§­ Region Valid": "âœ…" if is_valid_number_for_region(p, region_code_for_number(p)) else "âŒ",
            "ğŸš¨ Emergency": "âœ…" if is_emergency_number(raw_input, "IN") else "âŒ",
            "ğŸ”Œ Extension": p.extension if p.extension else "None",
            "ğŸ‡®ğŸ‡¹ Italian Leading Zero": "âœ…" if getattr(p, "italian_leading_zero", False) else "âŒ",
            "ğŸ•“ Timezones": ', '.join(tz) if tz else "N/A",
            "â±ï¸ Timezone Count": len(tz),
            "ğŸ•’ UTC Sample": tz[0] if tz else "N/A",
            "ğŸ”¢ Prefix 3": str(p.national_number)[:3],
            "ğŸ”¢ Suffix 4": str(p.national_number)[-4:],
            "ğŸ§¬ Raw Object": str(p),
            "ğŸ“š Metadata Loaded": "âœ…" if getattr(phonenumbers.PhoneMetadata, "metadata", None) else "âŒ",
            "ğŸ“¦ Library": "phonenumbers Python",
            "ğŸ§  Analyzed By": "@KrsxhPy"
        }
    except NumberParseException:
        return {"error": "âŒ Invalid number format."}

def display(info):
    if "error" in info:
        print(Fore.RED + info["error"])
        return
    print(Fore.YELLOW + "\nğŸ“‹ ANALYSIS REPORT")
    for k, v in info.items():
        print(f"{Fore.CYAN}{k:<26} âœ {Fore.WHITE}{v}")

def save_to_txt(info):
    path = os.path.join(os.getcwd(), "KrsxhNumberReport.txt")
    with open(path, 'w', encoding='utf-8') as f:
        for k, v in info.items():
            f.write(f"{k}: {v}\n")
        f.write("\nğŸ” Generated by: @KrsxhPy\n")
    print(Fore.GREEN + f"\nâœ… Report saved at: {path}")

def main():
    banner()
    num = input(Fore.LIGHTBLUE_EX + "ğŸ“ Enter number (with country code): ").strip()
    info = analyze_number(num)
    display(info)
    if "error" not in info:
        save_to_txt(info)

if __name__ == "__main__":
    main()
